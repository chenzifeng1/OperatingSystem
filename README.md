# 操作系统概述
## 进程：一个计算机正在运行的程序的一个实例  
### 背景介绍：  
计算机发展脉络分为三条主线：a.多程序批处理系统；b.分时系统；c.实时事物系统


三者在时间分配和同步上产生的问题推动了进程的发展。进程的出现很好的解决了一些难以再现的程序软件错误，这一类错误通常有以下原因  
- 不正确的同步：
- 失败的互斥：如多个程序或用户试图访问同一个共享资源，而该共享资源没有被合理的保护起来。
- 不确定的程序操作
- 死锁：死锁产生的四个必要条件，只要出现死锁，必然满足以下所有条件。  
    1. 互斥条件：一个资源每次只能被一个进程使用。  
    2. 请求与保持条件：一个进程因请求资源而阻塞时，对已获得的资源保持不放。  
    3. 不剥夺条件:进程已获得的资源，在末使用完之前，不能强行剥夺。  
    4. 循环等待条件:若干进程之间形成一种头尾相接的循环等待资源关系。  
### 进程有三个部分组成：  
    1.一段可执行的程序。  
    2.程序所需的相关数据（变量，工作区间，缓冲区等）
    3.程序执行的上下文：又称进程状态，是操作系统用来管理和控制进程所需要的内部数据。
 操作系统为每个进程分配了一块存储器区域，建立并维护进程表（一种数据结构）对进程进行记录。进程表的每一个表现记录的为指向包含进程的存储块地址的指针。  
### 与进程有关的几个寄存器：  
    1. 进程索引寄存器(process index register)：包含当前获取cpu控制权的进程在进程表的索引。  
    2. 程序计数器(program counter)：指向进程中下一条待执行的指令。  
    3. 基址寄存器(base register)：保存进程所在存储区域的首地址。  
    4. 界限寄存器(limit register)；保存进程所在存储区域的大小。  
程序计数器和所有数据引用相对于基址寄存器的内容进行解释（可以认为这些数据引用都是偏移值），且不能超过界限寄存器的值，以此来保护内部进程间不会相互干扰。  
## 内存管理：操作系统所具备的存储器管理职责  
    1. 进程隔离：操作系统必须保护独立的进程，防止相互干扰各自的存储空间，包括数据和指令。
    2. 自动分配和管理：程序应该根据需求在存储层次间动态的分配，操作系统要在进程需要存储空间时予以分配，并在进程生命周期结束时回收已分配的存储空间。  
    3. 支持模块化的程序设计：程序员应该能定义程序模块，并动态创建、销毁模块，动态改变魔抗的大小。  
    4. 保护和访问控制：限定不同级别的进程对不同的内存区域和指令的访问权。
    5. 长期存储： 在计算机断电后仍可以长期存储的信息(操作系统通过文件系统实现长期存储)。
对操作系统而言，文件是访问控制和保护的一个有用单元。在现代操作系统中，OS通过虚拟内存机制来管理存储，允许程序已逻辑地址去访问存储器，以这样的方式统一了程序的访存模式。
虚拟内存为每个进程都分配了一个虚拟内存空间，这样做的效果就像每一个进程都在独自使用内存一样。程序通过虚拟地址访问内存中的字，虚拟地址由两部分组成，一个是虚拟页号，一个是偏移量。虚拟地址通过地址翻译得到实际的物理地址。
具体过程根据计算机的配置略有不同，在有高速缓存和快表（后备缓冲寄存器）的情况下翻译过程不同，这一点会在后面介绍。  
![虚拟内存寻址](/picture/virtualSeekAddress.PNG)  

## 调度与资源管理：管理各种可用资源并调度进程去使用
### 资源分配和调度策略需要考虑的因素：
	1. 公平性：对竞争使用某一特定资源的所有进程提供几乎同等和公平的机会，尤其是对同一类作业。
	2. 有差别的响应性：操作系统需要区分不同服务需求的不同作业类别，并根据作业的优先级进行有差别的分配资源和调度。
	3. 有效性：操作系统希望获取最大吞吐量和最小响应时间，并在分时情形下可以容纳尽可能多的用户，但这些标准互相矛盾，需要得到一个有效的平衡。  
多道程序性设计环境中涉及进程调度和资源分配的操作系统的主要组件有：1.服务调用处理程序 2.中断处理程序 3.长程队列 4.短程队列 5. I/O队列 6.短程调度程序。
操作系统通过维护不同的队列来标识不同类的进程：  
	短程队列由在内存中（或至少最基本的部分在内存中）并等待处理器可用时随时准备运行的进程组组成。  
	长程队列是等待使用处理器的新作业列表，操作系统通过将长程队列中的作业添加到短程队列中来实现向系统添加作业的任务，这时内存的一部分必须分配给新到的作业。  
	每个I/O设备都有一个I/O队列，因为可能有多个进程请求一个I/O设备。所有等待使用一个I/O设备的进程在该I/O设备的队列中排队。    
![系统调用与资源管理](/picture/systemCall.PNG)
# Linux系统概述
Linux系统有很多可加载模块(loaded module)组成，可以通过命令来加载或卸载相应的模块。实际上，模块就是一些内核在运行时可以链接或者是断开链接的对象文件，一个模块通常实现特定的功能，尽管模块可以因为各种目的而创建内核线程，但是自身不能作为进程或者是线程来执行。  
可加载模块的两个重要特征：1.动态链接，当内核已存在内存中并正在运行的时，内核模块可以被加载和链接到内核。模块也可以随时被断开链接，并移出内存。 2.可堆叠模块，模块可以按照层次结构排列，高层模块可以作为客户访问底层模块。  
##### 动态链接